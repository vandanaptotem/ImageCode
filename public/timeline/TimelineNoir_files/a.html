<!DOCTYPE html>
<html>
<head>
  <title>TimelineNoir</title>
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootstrap/3.1.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.css">

  <link href="/assets/application.css?body=1" media="all" rel="stylesheet" />
<link href="/assets/bootstrap.min.css?body=1" media="all" rel="stylesheet" />
<link href="/assets/welcome.css?body=1" media="all" rel="stylesheet" />
  <script src="/assets/jquery.js?body=1"></script>
<script src="/assets/jquery_ujs.js?body=1"></script>
<script src="/assets/bootstrap.min.js?body=1"></script>
<script src="/assets/fbShare.js?body=1"></script>
<script src="/assets/jquery.nicescroll.min.js?body=1"></script>
<script src="/assets/jquery.touchSwipe.min.js?body=1"></script>
<script src="/assets/welcome.js?body=1"></script>
<script src="/assets/application.js?body=1"></script>
  <meta content="authenticity_token" name="csrf-param" />
<meta content="nhomkJYv4DNUCcxMxasy4Lx3Mont05qgF1atB7jC70c=" name="csrf-token" />

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-52508994-1', 'detectime.com');
  ga('send', 'pageview');

</script>

 //  <script>
	// (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	//   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	// m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	// })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	//   ga('create', 'UA-48860754-1', 'detectime.com');
	//   ga('send', 'pageview');

 //  </script> 
</head>
<body>

<div class="row visible-lg visible-md">
  <div class="col-lg-2" id="aside">
    <div id="asideBack"></div>
    <div id="asideFront">
      <img alt="Logo" id="logo" src="/assets/logo.png" />
      <ul class="menu">
        <li class="crimeSceneBtn"><img alt="Crimescene" class="menuBtn" src="/assets/crimescene.jpg" title="Explore the Crime Scene" /></li>
        <li class="charactersBtn"><img alt="Characters" class="menuBtn" src="/assets/characters.jpg" title="Interview the Suspects" /></li>
        <li class="caseBtn"><img alt="Brief" class="menuBtn" src="/assets/brief.jpg" title="Solve the Case" /></li>
      </ul>
      
    </div>
  </div>
  <div class="col-lg-10">
    <div class="row" id="contentRow">
      <div id="contentPanel">
        <div id="panelBack"></div>
        <div id="panelFront">
          <div id="panelTitle"></div>
          <div id="caseName" class="casePanel">
            <div class="row">
              The Case of the Barber Butcher
              <img alt="Crimetape" src="/assets/crimeTape.png" />
            </div>
            <div class="row">
              <div class="col-lg-6"></div>
              <div class="col-lg-6" id="briefing">
                A small but happy village. Unlike the fast moving life of glamorous cities, this village had a calm and serene life. Or so they thought. One of the two barbers in the village, Kamal, has been found murdered. Villagers are clueless as to what could have lead to this sudden event.
                <br/>
                <br/>
                Looks like I'll have to go down to the grassroot level to solve this case. It's a small village, but its secrets still elude me. I will have look close and dig deep to get to the bottom of this...
                <br/>
                <br/>
              </div>
            </div>
          </div>
          <div id="crimeScene" class="casePanel">
            <div class="row">
              <div class="col-lg-5 crimeSceneOverlay lvl1">
                <img alt="Lvl1" src="/assets/lvl1.jpg" />
                <h4 class="clue">Explore the crime scene by hovering over the
                  photos and clicking on the interesting spots.</h4>
              </div>
              <div class="col-lg-3 crimeSceneOverlay lvl2">
              </div>
              <div class="col-lg-3 crimeSceneOverlay lvl3">
              </div>
            </div>
          </div>
          <div id="characters" class="casePanel">
            <div class="row" id="charMenu"></div>
            <div id="suspectPanel">
              <div class="row">
                <div class="col-lg-4"><img src="#" id="suspectPhoto"/></div>
                <div class="col-lg-7">
                  <div class="row">
                    <div id="suspectName"></div>
                    <img alt="Interrogate" id="interrogateEm" src="/assets/interrogate.png" style="position:absolute; width:20%;right:0;top:30px;cursor:pointer;" title="Interrogate the Person" />
                  </div>
                  <div class="row">
                    <div class="col-lg-7" id="suspectProfile"></div>
                    <div class="col-lg-5" id="suspectReaction"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div id="comments" class="casePanel">
            <br/>
            <br/>

            <div class="row">
              <div class="col-lg-10" id="commentsBack">
                <div class="row" style="margin-left: 20px;">
                  <div class="col-lg-12" style="border-bottom: 1px solid #333">
                    <textarea id="u_0_c" aria-owns="typeahead_list_u_0_b" aria-expanded="false" autocomplete="off" aria-autocomplete="list" role="textbox" name="text" placeholder="Who is the killer and why did they do it?" required="1" class="DOMControl_placeholder uiTextareaNoResize uiTextareaAutogrow input mentionsTextarea textInput"></textarea>
                    <input type="submit" id="u_0_2" value="Comment" class="btn btn-warning btn-sm pull-right u_0_2" style="margin-bottom: 10px">
                  </div>
                </div>
                <br/>

                <div class="row">
                  <div class="col-lg-12" id="commentsWrapper">
                    <ul id="allist" class="UFIList"></ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Phone Code -->

<div class="row hidden-md hidden-lg ">
  <div class="row" style="margin-top: 5%" id="menu-xs">
    <div class="col-xs-5 col-xs-offset-1 col-sm-5 col-sm-offset-1">
      <img alt="Logo xs" id="logo-xs" src="/assets/logo-xs.png" />
    </div>
    <div class="col-xs-5 col-sm-5" id="header-xs">
      <div id="panelTitle-xs"></div>
      <a href="#" id="backToMain"><img src="/assets/back.gif" style="width:50%"/></a>
    </div>
  </div>

  <div id="contentRow-xs">
    <div class="row casePanel-xs" id="title-xs">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2">
          <br/>
          <br/>

          <h1 id="caseName-xs">The Case of the Barber Butcher</h1>
          <br/>
          <br/>
          <div class="row">
            <img alt="Start" class="col-sm-4 col-xs-4" onclick="$(this).parent().parent().fadeOut();$(&#39;#caseProfile-xs&#39;).fadeIn().animate({opacity:&#39;1&#39;},500);" src="/assets/start.png" />
          </div>
        </div>
      </div>
      <div class="row" id="caseProfile-xs">
        <div class="row">
          <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2">
            A small but happy village. Unlike the fast moving life of glamorous cities, this village had a calm and serene life. Or so they thought. One of the two barbers in the village, Kamal, has been found murdered. Villagers are clueless as to what could have lead to this sudden event.
            <br/>
            <br/>
            Looks like I'll have to go down to the grassroot level to solve this case. It's a small village, but its secrets still elude me. I will have look close and dig deep to get to the bottom of this...
            <br/>
            <br/>
          </div>
        </div>
        <div class="row">
          <div class="col-xs-6 col-xs-offset-3 col-sm-6 col-sm-offset-3 menu">
            <div class="row">
              <div class="crimeSceneBtn col-sm-4 nopad"><img alt="Crimescene" class="menuBtn-xs" src="/assets/crimescene.jpg" />
                <div class="help-xs">Crime Scene</div>
              </div>
              <div class="charactersBtn col-sm-4 nopad"><img alt="Characters" class="menuBtn-xs" src="/assets/characters.jpg" />
                <div class="help-xs">Characters</div>
              </div>
              <div class="caseBtn col-sm-4 nopad"><img alt="Brief" class="menuBtn-xs" src="/assets/brief.jpg" />
                <div class="help-xs">Solve It</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row casePanel-xs" id="crimeScene-xs">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 crimeSceneOverlay lvl1">
          <img alt="Lvl1" src="/assets/lvl1.jpg" />
        </div>
        <div class="col-xs-7 col-xs-offset-3 col-sm-7 col-sm-offset-3 crimeSceneOverlay lvl2 lvl2-xs">
        </div>
        <div class="col-xs-6 col-xs-offset-4 col-sm-6 col-sm-offset-4 crimeSceneOverlay lvl3 lvl3-xs">
        </div>
      </div>
      <br/>

      <div class="row">
        <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2 crimeSceneInstruction">
          <h4 class="clue">Explore the crime scene by tapping over interesting spots in the photographs.</h4>
        </div>
      </div>
    </div>

    <div class="row casePanel-xs" id="characters-xs">
      <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2">
        <div class="row">
          <div class="col-xs-10 col-xs-offset-1 col-sm-10 col-sm-offset-1">
            <div id="carousel-characters" class="carousel slide" data-interval="false">
              <!-- Indicators -->

              <!-- Wrapper for slides -->
              <div class="carousel-inner" id="carouselBlocks"></div>

              <!-- Controls -->
              <a class="left carousel-control" href="#carousel-characters" data-slide="prev">
                <span class="glyphicon glyphicon-chevron-left"></span>
              </a>
              <a class="right carousel-control" href="#carousel-characters" data-slide="next">
                <span class="glyphicon glyphicon-chevron-right"></span>
              </a>
            </div>
            <img alt="Interrogate" id="interrogateEm-xs" src="/assets/interrogate.png" style="position:absolute; width:50%;right:-2em;top:1em;" />
          </div>
        </div>
        <div class="row" id="suspectPanel-xs">
          <div id="suspectName-xs"></div>
          <div id="suspectProfile-xs"></div>
          <div id="suspectReaction-xs"></div>
        </div>
      </div>
    </div>

    <div class="row casePanel-xs" id="comments-xs">
      <div class="row">
        <div class="col-xs-8 col-xs-offset-2 col-sm-8 col-sm-offset-2" id="commentsBack-xs">
          <div class="row">
            <textarea id="u_0_c-xs" aria-owns="typeahead_list_u_0_b" aria-expanded="false" autocomplete="off" aria-autocomplete="list" role="textbox" name="text" placeholder="Who is the killer and why did they do it?" required="1" class="DOMControl_placeholder uiTextareaNoResize uiTextareaAutogrow input mentionsTextarea textInput"></textarea>
            <input type="submit" id="u_0_2-xs" value="Comment" class="btn btn-warning btn-xs pull-right u_0_2">
          </div>
          <br/>

          <div class="row">
            <div id="commentsWrapper-xs">
              <ul id="allist-xs" class="UFIList"></ul>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>

</div>

<script type="text/javascript" charset="utf-8">

    /*-----------------------------------------*/
    /* Case Input Structures Left,Top,Width,Height%*/
    /*-----------------------------------------*/

    var lvl1Nodes = ["60,70,30,25", "60,55,15,7", "85,50,12,14"];
    var lvl1Data = ["The body was found here...hmmm||clue-body.jpg||So this is where he breathed his last...I should have a closer look...", "The obvious murder weapon. Or is it?||clue-knife.jpg||A normal barber\'s blade...I wonder if there is anything unusual about it", "What\'s that on the ground?||clue-cigs.jpg||These cigarette butts doesn\'t look very old. Aren\'t cigarettes expensive in the village...I wonder who could afford them"];
    var lvl2Nodes = [
        ["18,30,19,15", "73,31,13,10", "34,30,38,20"],
        ["10,44,51,15"],
        []
    ];
    var lvl2Data = [
        ["I think this is what killed him||clue-cut.jpg||Looks like the killer did quite a number on Kamal. Not an easy task with such a blade...Looks like the killer had used something similar before", "What's that mark on his finger?||clue-tan.jpg||Hmmm...A ring seems to be missing...Could it have been taken by the killer?", "What\'s this on his shirt?||clue-hair.jpg||Looks like hair, but doesn\'t seem to be his...Maybe one of his customers I guess...or could it be the killer\'s"],
        ["Looks like something\'s carved on the handle||clue-kk.jpg||Hmmm...Looks like Kamal had a personalized blade..."],
        []
    ];

    var suspectNames = ['Kamal Kumar, Victim', 'Bhairav Thakur, Barber','Raju Kishan, Kamal\'s son-in-law', 'Shanti Kishan, Kamal\'s daughter', 'Rudra Chauhan, Loan Shark'];
    var suspectPhotos = ['/assets/victim-kamal.jpg', '/assets/suspect-bhairav.jpg', '/assets/suspect-raju.jpg', '/assets/suspect-shanti.jpg', '/assets/suspect-rudra.jpg'];
    var suspectBios = ['A renowned barber in the village where he was loved and respected by all. He lost his wife at a young age and has worked hard to provide for his only daughter. His business has done quite well over the years but his debts seem to rise meteorically every year. He has some property and land to his name but holds it close to his heart and has promised never to let it go.',
        'The only other barber in the village. Shrewd in business,he has always seen Kamal as a threat to his livelihood. He is extremely envious of Kamal\'s popularity. He is well known by the villagers for his mercurial nature. He seems quite well kempt for a villager..Not a hair out of place. ',
        'A typical small town guy, always dreaming big but doing nothing about it. I don\'t know how he landed such a beauty of a wife and how she still tolerates him. He\'s known around the village for his chain smoking and pretty much wasting his time away. What a loser...',
        'A loving daughter and a foolish yet supportive wife. She admired her husband\'s ambition and had started dreaming herself. She had grown distant from her father after getting married. I wonder how that old man allowed them to get married!',
        'A notorious money lender known to have inflated interest rate and penchant for making examples out of defaulters. Had lent a small sum of money to Kamal a decade ago but has inflated his interests so much that the paid amount has exceeded 50 times its intitial value. A normal village loan shark I guess...A real scumbag'
        ];
    var suspectReactions = ['',
        'I\'m very sad at the loss of a fellow barber. Though we may not have seen each other eye to eye, I always respected him. This village is not very safe especially for us rich folk, that’s why I carry my equipment with me wherever I go.',
        ' This is a cursed village. My beloved father-in-law\'s life has been taken away by some miscreant. I don\'t wish to live here anymore! I want to move out and goto the nearby city as soon as possible',
        'I wonder who could do this to him. He had never wronged anyone in the village. I hope the killer burns in hell. I guess my husband and I will move someplace else and start over.',
        'Why am I a suspect here? I am just a helpful money lender. What would I gain if my customers start dropping dead? In any case, I would not harm anybody, especially Kamal who everyone seems to adore. Besides I\'m a rich man, I was thinking of retiring soon.'
        ];

    /*-----------------------------------------*/
    /* Case Variables Initializer*/
    /*-----------------------------------------*/

    var crimeSceneInit = false;
    var suspectListInit = false;

    var overlayLvl1 = [];
    var srcLvl2 = [];
    var overlayLvl2 = [
        [],
        [],
        []
    ];
    var srcLvl3 = [
        [],
        [],
        []
    ];

    var lvl2Clues, lvl2CluePosy;

    function createCrimeScene() {
        var coordsLvl1 = [];
        var contentLvl1 = [];
        var coordsLvl2 = [
            [],
            [],
            []
        ];
        var contentLvl2 = [
            [],
            [],
            []
        ];
        for (var nodeLvl1 = 0; nodeLvl1 < lvl1Nodes.length; nodeLvl1++) {
            coordsLvl1[nodeLvl1] = lvl1Nodes[nodeLvl1].split(',');
            contentLvl1[nodeLvl1] = lvl1Data[nodeLvl1].split('||');
            overlayLvl1[nodeLvl1] = '<a href="#" title="' + contentLvl1[nodeLvl1][0] + '" class="overlayPoint" id="node1' + nodeLvl1 + '" style="left:' + coordsLvl1[nodeLvl1][0] + '%;top:' + coordsLvl1[nodeLvl1][1] + '%;width:' + coordsLvl1[nodeLvl1][2] + '%;height:' + coordsLvl1[nodeLvl1][3] + '%;"></a>';
            srcLvl2[nodeLvl1] = '<img src="/assets/' + contentLvl1[nodeLvl1][1] + '"/><h4 class="clue">' + contentLvl1[nodeLvl1][2] + '</h4>';
            for (var nodeLvl2 = 0; nodeLvl2 < lvl2Nodes[nodeLvl1].length; nodeLvl2++) {
                coordsLvl2[nodeLvl1][nodeLvl2] = lvl2Nodes[nodeLvl1][nodeLvl2].split(',');
                contentLvl2[nodeLvl1][nodeLvl2] = lvl2Data[nodeLvl1][nodeLvl2].split('||');
                overlayLvl2[nodeLvl1][nodeLvl2] = '<a href="#" title="' + contentLvl2[nodeLvl1][nodeLvl2][0] + '" class="overlayPoint" id="node2_' + nodeLvl1 + "_" + nodeLvl2 + '" style="left:' + coordsLvl2[nodeLvl1][nodeLvl2][0] + '%;top:' + coordsLvl2[nodeLvl1][nodeLvl2][1] + '%;width:' + coordsLvl2[nodeLvl1][nodeLvl2][2] + '%;height:' + coordsLvl2[nodeLvl1][nodeLvl2][3] + '%;"></a>';
                srcLvl3[nodeLvl1][nodeLvl2] = '<img src="/assets/' + contentLvl2[nodeLvl1][nodeLvl2][1] + '"/><h4 class="clue">' + contentLvl2[nodeLvl1][nodeLvl2][2] + '</h4>';
            }
        }
    }

    function overlayLvl2Bindings() {
        $("[id^=node1]").on('click', function () {
            var branch = parseInt($(this).attr("id").split("node1")[1]);
            var $lvl2 = $('.crimeSceneOverlay.lvl2');
            var $lvl3 = $('.crimeSceneOverlay.lvl3');
            $lvl2.hide().empty();
            $lvl3.hide().empty();
            $lvl2.append(srcLvl2[branch]).fadeIn('500');
            overlayLvl2[branch].forEach(function (elm) {
                $lvl2.append(elm);
                $('[title!=""]').qtip({
                    position: {
                        my: 'bottom left',  // Position my top left...
                        at: 'top right', // at the bottom right of...
                        target: 'mouse' // my target
                    }
                });
            });
            overlayLvl3Bindings();
        });
    }
    function overlayLvl2BindingsXs() {
        $("[id^=node1]").on('click', function () {
            var branch = parseInt($(this).attr("id").split("node1")[1]);
            var $lvl1 = $('.crimeSceneOverlay.lvl1');
            var $lvl2 = $('.crimeSceneOverlay.lvl2');
            var $lvl3 = $('.crimeSceneOverlay.lvl3');
            var $notes = $('.crimeSceneInstruction');
            $notes.html('<h4 class="clue">' + $(this).attr('title') + '</h4>');
            $lvl2.hide().empty();
            $lvl3.hide().empty();
            $lvl1.hide();
            $lvl2.append('<img id="back1" src="' + $('.crimeSceneOverlay.lvl1 img').first().attr('src') + '" onclick="goBack1()"/>');
            $lvl2.append(srcLvl2[branch]).delay(500).fadeIn('500');
            $notes.append($lvl2.find('.clue').first());
            $lvl2.find('.clue').css('opacity', '0');
            lvl2CluePosy = "-" + $lvl2.find('.clue').outerHeight() + "px";
            $notes.animate({
                marginTop: lvl2CluePosy
            });
            overlayLvl2[branch].forEach(function (elm) {
                $lvl2.append(elm);
            });
            overlayLvl3BindingsXs();
        });
    }

    function goBack1() {
        $('.crimeSceneOverlay.lvl2').hide().empty();
        $('.crimeSceneOverlay.lvl1').fadeIn();
        $('.crimeSceneInstruction').html('<h4 class="clue">The victim was found in the makeup room. Explore the crime scene by tapping over interesting spots in the photographs.</h4>').animate({marginTop: '0'});
    }
    function goBack2() {
        $('.crimeSceneOverlay.lvl2').hide().empty();
        $('.crimeSceneOverlay.lvl3').hide().empty();
        $('.crimeSceneOverlay.lvl1').fadeIn();
        $('.crimeSceneInstruction').html('<h4 class="clue">The victim was found in the makeup room. Explore the crime scene by tapping over interesting spots in the photographs.</h4>').animate({marginTop: '0'});
    }
    function goBack3() {
        $('.crimeSceneOverlay.lvl3').hide().empty();
        $('.crimeSceneOverlay.lvl2').fadeIn();
        $('.crimeSceneInstruction').html(lvl2Clues).animate({marginTop: lvl2CluePosy});
    }

    function overlayLvl3Bindings() {
        $("[id^=node2]").on('click', function () {
            var root = parseInt($(this).attr("id").split("_")[1]);
            var branch = parseInt($(this).attr("id").split("_")[2]);
            var $lvl3 = $('.crimeSceneOverlay.lvl3');
            $lvl3.hide().empty();
            $lvl3.append(srcLvl3[root][branch]).fadeIn('500');
        });
    }
    function overlayLvl3BindingsXs() {
        $("[id^=node2]").on('click', function () {
            var root = parseInt($(this).attr("id").split("_")[1]);
            var branch = parseInt($(this).attr("id").split("_")[2]);
            var $lvl3 = $('.crimeSceneOverlay.lvl3');
            lvl2Clues = $('.crimeSceneInstruction').html();
            $('.crimeSceneInstruction').html('<h4 class="clue">' + $(this).attr('title') + '</h4>');
            $('.crimeSceneOverlay.lvl2').hide();
            $lvl3.hide().empty();
            $lvl3.append('<img id="back2" src="' + $('.crimeSceneOverlay.lvl1 img').eq(0).attr('src') + '" onclick="goBack2()"/>');
            $lvl3.append('<img id="back3" src="' + $('.crimeSceneOverlay.lvl2 img').eq(1).attr('src') + '" onclick="goBack3()"/>');
            $lvl3.append(srcLvl3[root][branch]).fadeIn('500');
            $('.crimeSceneInstruction').append($lvl3.find('.clue').first());
            $lvl3.find('.clue').css('opacity', '0');
            $('.crimeSceneInstruction').animate({
                marginTop: "-" + $lvl3.find('.clue').outerHeight() + "px"
            });

        });
    }

    function buildSuspects() {
        if (!suspectListInit) {
            $('#charMenu').append('<div class="col-lg-' + (11 - suspectPhotos.length) + '"></div>');
            for (i = 0; i < suspectPhotos.length; i++) {
                $('#charMenu').append('<div class="col-lg-1 suspectThumb"><img src="' + suspectPhotos[i] + '" id="suspect' + i + '"/></div>');
            }
            suspectListInit = true;
        }
        $('.suspectThumb img').on('click', function () {
            var index = $(this).attr("id").split('suspect')[1];
            $('#suspectPhoto').attr('src', suspectPhotos[index]);
            $('#suspectName').html(suspectNames[index].split(',')[0] + "<br/><span id='suspectContext'>" + suspectNames[index].split(',')[1] + "</span>");
            $('#suspectProfile').html(suspectBios[index]);
            $('#suspectReaction').html(suspectReactions[index]).hide();
            if (index == 0) {
                $('#interrogateEm').fadeOut();
            } else {
                $('#interrogateEm').fadeIn().qtip({
                    position: {
                        my: 'bottom left',  // Position my top left...
                        at: 'top right', // at the bottom right of...
                        target: 'mouse' // my target
                    }
                });
            }
        });
    }

    function buildSuspectsXs() {
        if (!suspectListInit) {
            for (i = 0; i < suspectPhotos.length; i++) {
                $('#carouselBlocks').append('<div class="item suspectThumb-xs"><img src="' + suspectPhotos[i] + '" id="suspect' + i + '"/></div>');
            }
            suspectListInit = true;
            $('.item').first().addClass('active');
            $('#suspectName-xs').html(suspectNames[0].split(',')[0] + "<br/><span id='suspectContext-xs'>" + suspectNames[0].split(',')[1] + "</span>");
            $('#suspectProfile-xs').html(suspectBios[0]);
            $('#suspectReaction-xs').html('<span class="closeInter">&times;<span>' + suspectReactions[0]).hide();
        }

        var carousel = $('#carousel-characters').carousel({
            wrap: false,
            threshold: 0
        });

        $(".carousel-inner").swipe({
            swipeLeft: function (event, direction, distance, duration, fingerCount) {
                $(this).parent().carousel('next');
            },
            swipeRight: function () {
                $(this).parent().carousel('prev');
            }
        });

        carousel.on('slide.bs.carousel', function (event) {
            var index = $(event.relatedTarget).index();
            stopInterro();
            $('#suspectName-xs').html(suspectNames[index].split(',')[0] + "<br/><span id='suspectContext-xs'>" + suspectNames[index].split(',')[1] + "</span>");
            $('#suspectProfile-xs').html(suspectBios[index]);
            $('#suspectReaction-xs').html('<span class="closeInter" onclick="stopInterro();">&times;</span>' + suspectReactions[index]).hide();
            if (index == 0) {
                $('#interrogateEm-xs').fadeOut();
            } else {
                $('#interrogateEm-xs').fadeIn();
            }
        });

    }

    function stopInterro() {
        $('#interrogateEm-xs').show();
        $('#suspectReaction-xs').hide();
        $('#suspectProfile-xs').fadeIn();
    }

    $.fn.activatePanel = function () {
        $('.casePanel').css({pointerEvents: 'none'});
        $('.casePanel-xs').css({pointerEvents: 'none'});
        $(this).animate({opacity: '1'});
        $(this).css({pointerEvents: 'auto'});
        $('#caseFile').css('opacity', '1').fadeIn();
    };

    function comment_now(at) {
        var message = $('#u_0_c').val();
	if(message == ""){
	    message =$('#u_0_c-xs').val();	
	}
        var obj_id = '1519325818296676';
        FB.login(function (response) {
            if (response.authResponse) {
                at = response.authResponse.accessToken;
                $.post('https://graph.facebook.com/' + obj_id + '/comments?message=' + message + '&access_token=' + at, function (respo) {
                    alert("Your comment has been posted on this week's case photo. Go check it out!");
                    setTimeout(function () {
                        present_comment();
                        $('#u_0_c').val('');
                    }, 500);

                });
            }
        }, {scope: 'publish_stream,publish_actions'});
    }
    ;

    function fb_comment() {
        var at = '';
	FB.getLoginStatus(function (response) {
	    if (response.status == "connected") {
                at = response.authResponse.accessToken;
                comment_now();

            }
            else if (response.status == "notConnected") {
                FB.ui({
                    client_id: '113381182103752',
                    method: 'oauth',
                    redirect_uri: 'http://www.detectime.com',
                    response_type: 'token',
                    perms: 'publish_stream,publish_actions'
                }, function (res) {
                    at = res.access_token;
                    comment_now();
                });
            }
            else if (response.status == "unknown") {
                comment_now();
            }
            else {
                comment_now();
            }
        });
    }

    function present_comment() {
        $.get('https://graph.facebook.com/1519325818296676/comments', function (res) {
            $('.prev_comments').empty().remove();
            $.each(res.data, function (i, v) {
                hr = "https://www.facebook.com/" + v.from.id;
                pic = "https://graph.facebook.com/" + v.from.id + "/picture"
                $('#allist').append('<li class="prev_comments"><div class="row"><div class="given_pic">' +
                        '<a href="' + hr + '" class="pull-right prev_comm">' +
                        '<img src="' + pic + '" alt=""/></a></div> <div class="given_comment">' +
                        '<a class="fbName" href="' + hr + '">' + v.from.name + '</a>  ' + v.message +
                        '<p>' + get_time_diff(v.created_time) + '</p></div></div></li>');
                $('#allist-xs').append('<li class="prev_comments"><div class="row"><div class="given_pic">' +
                        '<a href="' + hr + '" class="pull-right prev_comm">' +
                        '<img src="' + pic + '" alt=""/></a></div> <div class="given_comment">' +
                        '<a class="fbName" href="' + hr + '">' + v.from.name + '</a>  ' + v.message +
                        '<p>' + get_time_diff(v.created_time) + '</p></div></div></li>');
            });
            $("#commentsWrapper").niceScroll();
        })
    }

    function get_time_diff(datetime) {
        var datetime = typeof datetime !== 'undefined' ? datetime : "2014-01-01 01:02:03.123456";

        var datetime = new Date(datetime).getTime();
        var now = new Date().getTime();

        if (isNaN(datetime)) {
            return "";
        }

        if (datetime < now) {
            var milisec_diff = now - datetime;
        } else {
            var milisec_diff = datetime - now;
        }

        var days = Math.floor(milisec_diff / 1000 / 60 / (60 * 24));

        var date_diff = new Date(milisec_diff);

        if (days > 0) {
            return days + " days ago"
        } else if ((date_diff.getHours() - 5) > 0) {
            return (date_diff.getHours() - 5) + " hours ago"
        } else if ((date_diff.getMinutes() - 30) > 0) {
            return (date_diff.getMinutes() - 30) + " minutes ago"
        } else {
            return "few seconds ago"
        }

    }


    $(function () {

        present_comment();

        $('.menuBtn').qtip({
            position: {
                my: 'bottom left',  // Position my top left...
                at: 'top right', // at the bottom right of...
                target: 'mouse' // my target
            }
        });

        $('.crimeSceneBtn .menuBtn').on('click', function () {
            $('.casePanel').animate({opacity: '0'}, '500', function () {
                $('#crimeScene').activatePanel();
                $('#panelTitle').html("Crime Scene");
                if (!crimeSceneInit) {
                    createCrimeScene();
                    overlayLvl1.forEach(function (elm) {
                        $('.crimeSceneOverlay.lvl1').append(elm);
                        $('[title!=""]').qtip({
                            position: {
                                my: 'bottom left',  // Position my top left...
                                at: 'top right', // at the bottom right of...
                                target: 'mouse' // my target
                            }
                        });
                    });
                    overlayLvl2Bindings();
                }
                crimeSceneInit = true;
            });
        });
        $('.charactersBtn .menuBtn').on('click', function () {
            buildSuspects();
            $('.casePanel').animate({opacity: '0'}, '500', function () {
                $('#panelTitle').html("Character Backgrounds");
                $('#characters').activatePanel();
                $('#suspectPhoto').attr('src', suspectPhotos[0]);
                $('#suspectName').html(suspectNames[0].split(',')[0] + "<br/><span id='suspectContext'>" + suspectNames[0].split(',')[1] + "</span>");
                $('#suspectProfile').html(suspectBios[0]);
                $('#interrogateEm').hide();
                $('#suspectReaction').hide();

            });
        });

        $('#interrogateEm').on('click', function () {
            $('#suspectReaction').fadeIn();
        });

        $('#caseFile').on('click', function () {
            $('.casePanel').animate({opacity: '0'}, '500', function () {
                $('#panelTitle').html("");
                $('#caseName').activatePanel();
                $('#caseFile').css('opacity', '0');
            });
        });

        $('.caseBtn .menuBtn').on('click', function () {
            $('.casePanel').animate({opacity: '0'}, '500', function () {
                $('#panelTitle').html("Solve the Case");
                $('#comments').activatePanel();
                $('#caseFile').css('opacity', '0');
            });
        });

        $('.u_0_2').on('click', function () {
            if ($('#u_0_c').val() != "" || $('#u_0_c-xs').val()!="") {
                fb_comment();
            }
            return false;
        });

        /* Code for the Phone*/

        $('.crimeSceneBtn .menuBtn-xs').on('click', function () {
            $('.casePanel-xs').animate({opacity: '0'}, '500', function () {
                $('#crimeScene-xs').activatePanel();
                $('#panelTitle-xs').html("Crime Scene");
                $('#header-xs').fadeIn();
                if (!crimeSceneInit) {
                    createCrimeScene();
                    overlayLvl1.forEach(function (elm) {
                        $('.crimeSceneOverlay.lvl1').append(elm);
                    });
                    overlayLvl2BindingsXs();

                }
                crimeSceneInit = true;
            });
        });
        $('.charactersBtn .menuBtn-xs').on('click', function () {
            $('.casePanel-xs').animate({opacity: '0'}, '500', function () {
                buildSuspectsXs();
                $('#characters-xs').activatePanel();
                $('#panelTitle-xs').html("Characters");
                $('#header-xs').fadeIn();
            });
        });
        $('.caseBtn .menuBtn-xs').on('click', function () {
            $('.casePanel-xs').animate({opacity: '0'}, '500', function () {
                $('#comments-xs').activatePanel();
                $('#panelTitle-xs').html("Solve It");
                $('#header-xs').fadeIn();
            });
        });

        $('#backToMain').on('click', function () {
            $('.casePanel-xs').animate({opacity: '0'}, '500', function () {
                $('#panelTitle').html("");
                $('#title-xs').activatePanel();
                $('#header-xs').fadeOut();
            });
        });

        $('#interrogateEm-xs').on('click', function () {
            $(this).hide();
            $('#suspectProfile-xs').hide();
            $('#suspectReaction-xs').fadeIn();
        });


    })
</script>


<script src="http://cdn.jsdelivr.net/qtip2/2.2.0/jquery.qtip.min.js"></script>

</body>
</html>
